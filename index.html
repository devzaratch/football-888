<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOOBALL-888 | ‡∏î‡∏π‡∏ö‡∏≠‡∏•‡∏™‡∏î‡∏ü‡∏£‡∏µ</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        /* --- Dark Theme --- */
        body { background-color: #121212; color: #eee; font-family: 'Kanit', sans-serif; min-height: 100vh; }
        
        /* Navbar */
        .navbar { background: #000; border-bottom: 3px solid #e50914; padding: 12px 0; box-shadow: 0 4px 20px rgba(229, 9, 20, 0.3); }
        .brand-logo { font-size: 26px; font-weight: 800; color: #fff; letter-spacing: 1px; }
        .brand-logo span { color: #e50914; }

        .container-match { max-width: 900px; margin: 30px auto; padding: 0 15px; }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏•‡∏µ‡∏Å */
        .league-container { background-color: #1e1e1e; border-radius: 10px; overflow: hidden; margin-bottom: 25px; border: 1px solid #333; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .league-header { background: linear-gradient(90deg, #2c2c2c 0%, #1e1e1e 100%); color: #fff; padding: 12px 15px; font-weight: 600; font-size: 16px; border-bottom: 1px solid #444; display: flex; align-items: center; }
        .league-header i { margin-right: 10px; color: #e50914; }

        /* ‡πÅ‡∏ñ‡∏ß‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏≠‡∏• */
        .match-row { display: flex; align-items: center; justify-content: space-between; padding: 15px 10px; border-bottom: 1px solid #2a2a2a; background: #0b0b0b; transition: background 0.2s; }
        .match-row:last-child { border-bottom: none; }
        .match-row:hover { background: #161616; }

        /* ‡∏ó‡∏µ‡∏° (‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤) */
        .team-col { flex: 1; display: flex; align-items: center; font-size: 16px; font-weight: 400; color: #ddd; }
        .team-home { justify-content: flex-end; text-align: right; }
        .team-away { justify-content: flex-start; text-align: left; }
        .team-logo { width: 40px; height: 40px; object-fit: contain; margin: 0 15px; }

        /* ‡πÇ‡∏ã‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡πÄ‡∏ß‡∏•‡∏≤/‡∏õ‡∏∏‡πà‡∏°) */
        .middle-col { flex: 0 0 160px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .match-time { font-size: 20px; font-weight: 700; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .live-status { color: #e50914; font-weight: bold; animation: blink 1.5s infinite; font-size: 18px; margin-bottom: 5px; }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î */
        .btn-pill { 
            font-size: 12px; padding: 5px 15px; border-radius: 20px; border: none; 
            color: #fff; font-weight: 500; cursor: pointer; transition: 0.2s; 
            margin-bottom: 4px; text-transform: uppercase; width: 100%; display: block;
            text-decoration: none; text-align: center;
        }
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        .btn-green { background: linear-gradient(45deg, #00c853, #00e676); box-shadow: 0 0 8px rgba(0, 200, 83, 0.3); }
        .btn-green:hover { transform: scale(1.02); background: linear-gradient(45deg, #00e676, #00c853); color: #fff; }
        
        /* ‡∏õ‡∏∏‡πà‡∏° Telegram ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
        .btn-blue { background: linear-gradient(45deg, #0088cc, #00aaff); box-shadow: 0 0 8px rgba(0, 136, 204, 0.3); }
        .btn-blue:hover { transform: scale(1.02); background: linear-gradient(45deg, #00aaff, #0088cc); color: #fff; }

        .btn-grey { background: #333; color: #777; cursor: not-allowed; width: auto; padding: 4px 20px; }

        @keyframes blink { 50% { opacity: 0.5; } }

        /* ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (Overlay) */
        .video-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; backdrop-filter: blur(5px); }
        .player-wrapper { width: 95%; max-width: 1000px; aspect-ratio: 16/9; background: #000; border: 1px solid #333; border-radius: 10px; overflow: hidden; position: relative; box-shadow: 0 0 30px rgba(229, 9, 20, 0.3); }
        .close-btn { position: absolute; top: 10px; right: 10px; background: rgba(255, 0, 0, 0.8); color: white; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; z-index: 10; font-weight: bold; }
        .close-btn:hover { background: red; }
        
        /* ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì */
        #toast-msg {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 200, 83, 0.9); color: white; padding: 8px 16px; 
            border-radius: 20px; font-size: 14px; opacity: 0; transition: opacity 0.5s;
            pointer-events: none; z-index: 20; display: flex; align-items: center; gap: 8px;
        }

        /* Mobile */
        @media (max-width: 600px) {
            .match-row { padding: 12px 5px; }
            .team-col { font-size: 13px; flex-direction: column; justify-content: center; text-align: center; }
            .team-logo { width: 30px; height: 30px; margin: 5px 0; }
            .team-home { order: 1; flex-direction: column-reverse; }
            .team-away { order: 3; flex-direction: column; }
            .middle-col { order: 2; flex: 0 0 110px; } /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏õ‡∏∏‡πà‡∏° */
            .match-time { font-size: 18px; }
            .btn-pill { font-size: 10px; padding: 4px 5px; }
        }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="container text-center">
        <div class="brand-logo"><i class="bi bi-play-circle-fill"></i> DOOBALL<span>888</span></div>
    </div>
</nav>

<div class="container-match">
    <div class="text-center mb-4 mt-3">
        <h4 class="text-white fw-bold"><i class="bi bi-calendar-week text-danger"></i> ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ö‡∏≠‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
        <div class="text-secondary small" id="current-date"></div>
    </div>
    
    <div id="match-list">
        <div class="text-center py-5">
            <div class="spinner-border text-danger" role="status"></div>
            <p class="mt-3 text-secondary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏™‡∏î...</p>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

  // Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
  const firebaseConfig = {
    apiKey: "AIzaSyA_w7ZMYOx_eVqcFZ2EWrc2pn4QOIe4Ekg",
    authDomain: "football-888-b9a7e.firebaseapp.com",
    databaseURL: "https://football-888-b9a7e-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "football-888-b9a7e",
    storageBucket: "football-888-b9a7e.firebasestorage.app",
    messagingSenderId: "354132820390",
    appId: "1:354132820390:web:69b68bc56a506a7ed0cf67",
    measurementId: "G-RDZFSLYB30"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  document.getElementById('current-date').innerText = new Date().toLocaleDateString('th-TH', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

  // --- ‡∏£‡∏∞‡∏ö‡∏ö Player Control ---
  let currentWatchingId = null;
  let currentVideoUrl = "";
  let hlsInstance = null;

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏ä‡∏°
  window.watchMatch = function(matchId, link1, embedUrl, isM3u8) {
    currentWatchingId = matchId;
    currentVideoUrl = embedUrl;

    // 1. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå .m3u8 (‡∏î‡∏¥‡∏ö)
    if (embedUrl && (isM3u8 || embedUrl.includes('.m3u8'))) {
        createOverlay(`
            <video id="hls-player" controls autoplay style="width:100%;height:100%;background:#000;"></video>
            <div id="toast-msg"><i class="bi bi-lightning-fill"></i> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
        `);
        
        if (Hls.isSupported()) {
            var video = document.getElementById('hls-player');
            if(hlsInstance) hlsInstance.destroy();
            hlsInstance = new Hls();
            hlsInstance.loadSource(embedUrl);
            hlsInstance.attachMedia(video);
            hlsInstance.on(Hls.Events.MANIFEST_PARSED, function() { video.play(); });
            window.hlsInstance = hlsInstance;
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = embedUrl;
            video.addEventListener('loadedmetadata', function() { video.play(); });
        }
    } 
    // 2. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Iframe ‡∏õ‡∏Å‡∏ï‡∏¥
    else if (embedUrl && embedUrl !== "") {
        createOverlay(`<iframe src="${embedUrl}" style="width:100%;height:100%;border:0;" allowfullscreen></iframe>`);
    } 
    // 3. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á
    else {
        if(!link1) { alert('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏±‡∏ö‡∏ä‡∏°'); return; }
        window.open(link1, '_blank');
    }
  }

  function createOverlay(contentHtml) {
    const overlay = document.createElement('div');
    overlay.className = 'video-overlay';
    overlay.innerHTML = `
        <div class="player-wrapper">
            <button class="close-btn" onclick="closePlayer()">X</button>
            ${contentHtml}
        </div>
        <button class="btn btn-outline-light mt-4" onclick="closePlayer()">‚ùå ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
    `;
    document.body.appendChild(overlay);
  }

  window.closePlayer = function() {
      const overlay = document.querySelector('.video-overlay');
      if(overlay) overlay.remove();
      if(hlsInstance) { hlsInstance.destroy(); hlsInstance = null; }
      currentWatchingId = null;
      currentVideoUrl = "";
  }

  // --- Realtime Data & Auto Reconnect ---
  const matchesRef = ref(db, 'matches');
  onValue(matchesRef, (snapshot) => {
    const data = snapshot.val();
    const listDiv = document.getElementById('match-list');
    
    // üîÅ ‡∏£‡∏∞‡∏ö‡∏ö Auto-Reconnect (‡∏ñ‡πâ‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
    if (currentWatchingId && data && data[currentWatchingId]) {
        const matchData = data[currentWatchingId];
        const newUrl = matchData.embed_url;
        
        if (newUrl && newUrl !== currentVideoUrl) {
            console.log("‚ö° ‡∏û‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏´‡∏°‡πà! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì...");
            currentVideoUrl = newUrl;
            
            const videoEl = document.getElementById('hls-player');
            const toast = document.getElementById('toast-msg');
            
            if (videoEl && Hls.isSupported() && window.hlsInstance) {
                window.hlsInstance.loadSource(newUrl);
                window.hlsInstance.attachMedia(videoEl);
                window.hlsInstance.on(Hls.Events.MANIFEST_PARSED, function() { videoEl.play(); });
                
                if(toast) {
                    toast.style.opacity = '1';
                    setTimeout(() => { toast.style.opacity = '0'; }, 3000);
                }
            }
        }
    }

    // üé® Render HTML
    listDiv.innerHTML = "";
    if (data) {
        const groups = {};
        Object.keys(data).forEach(key => {
            const m = data[key];
            m.key = key; 
            const leagueName = m.league || "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ";
            if (!groups[leagueName]) groups[leagueName] = [];
            groups[leagueName].push(m);
        });

        Object.keys(groups).forEach(leagueName => {
            const matches = groups[leagueName];
            let groupHtml = `<div class="league-container"><div class="league-header"><i class="bi bi-trophy-fill"></i> ${leagueName}</div>`;

            matches.forEach(m => {
                const isNowLive = m.is_live || m.time.toLowerCase().includes('live') || m.time.includes('‡πÄ‡∏£‡∏¥‡πà‡∏°');
                
                // Logo
                const homeLogo = m.home_logo ? `<img src="${m.home_logo}" class="team-logo">` : `<div style="width:40px;height:40px;margin:0 15px;"></div>`;
                const awayLogo = m.away_logo ? `<img src="${m.away_logo}" class="team-logo">` : `<div style="width:40px;height:40px;margin:0 15px;"></div>`;

                let centerContent = '';
                if (isNowLive) {
                    const isM3u8 = m.is_m3u8 || (m.embed_url && m.embed_url.includes('.m3u8'));
                    
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î
                    let buttonsHtml = `
                        <button class="btn-pill btn-green" onclick="watchMatch('${m.key}', '${m.links.link1}', '${m.embed_url}', ${isM3u8})">
                            <i class="bi bi-play-circle-fill"></i> ‡∏£‡∏±‡∏ö‡∏ä‡∏°‡∏™‡∏î (‡∏´‡∏•‡∏±‡∏Å)
                        </button>
                    `;

                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Telegram ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏ü‡πâ‡∏≤
                    if (m.links.telegram) {
                        buttonsHtml += `
                            <a href="${m.links.telegram}" target="_blank" class="btn-pill btn-blue">
                                <i class="bi bi-telegram"></i> ‡∏™‡∏≥‡∏£‡∏≠‡∏á (Telegram)
                            </a>
                        `;
                    }

                    centerContent = `<div class="live-status">LIVE</div>${buttonsHtml}`;
                } else {
                    centerContent = `<div class="match-time">${m.time}</div><button class="btn-pill btn-grey" disabled>‡∏£‡∏≠‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</button>`;
                }

                groupHtml += `
                    <div class="match-row">
                        <div class="team-col team-home"><span class="d-none d-sm-inline">${m.home}</span><span class="d-inline d-sm-none small">${m.home}</span>${homeLogo}</div>
                        <div class="middle-col">${centerContent}</div>
                        <div class="team-col team-away">${awayLogo}<span class="d-none d-sm-inline">${m.away}</span><span class="d-inline d-sm-none small">${m.away}</span></div>
                    </div>`;
            });
            groupHtml += `</div>`;
            listDiv.innerHTML += groupHtml;
        });
    } else {
        listDiv.innerHTML = `<div class="text-center text-muted mt-5 py-5 border border-dark rounded bg-dark"><p class="m-0">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</p></div>`;
    }
  });
</script>

</body>
</html>