<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOOBALLLAOS | ดูบอลสด 24 ชม</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --primary: #ffcc00; --secondary: #ff3e3e; --bg-dark: #050505; --bg-card: #121417; --gold-grad: linear-gradient(180deg, #ffcc00 0%, #d4ac0d 100%); }
        body { background-color: var(--bg-dark); color: #fff; font-family: 'Kanit', sans-serif; }
        .navbar { background: #000; border-bottom: 3px solid var(--primary); padding: 12px 0; }
        .logo { font-size: 32px; font-weight: 900; color: #fff; text-decoration: none; }
        .logo span { color: var(--primary); }
        .container-main { max-width: 1250px; margin: 20px auto; padding: 0 15px; }
        .banner-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }
        .banner-item { border-radius: 12px; border: 1px solid #333; overflow: hidden; }
        .banner-item img { width: 100%; height: auto; display: block; }
        .league-card { background: var(--bg-card); border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 1px solid #222; }
        .league-title { background: #1a1d21; padding: 12px 20px; font-weight: 600; color: var(--primary); font-size: 14px; }
        .match-box { display: grid; grid-template-columns: 1fr 200px 1fr; align-items: center; padding: 25px 15px; border-top: 1px solid rgba(255,255,255,0.03); }
        .team { display: flex; align-items: center; gap: 15px; }
        .team-home { justify-content: flex-end; text-align: right; }
        .team-logo { width: 50px; height: 50px; object-fit: contain; }
        .vs-zone { text-align: center; }
        .time-label { font-size: 24px; font-weight: 800; color: #fff; line-height: 1; }
        .countdown-timer { font-size: 12px; color: var(--primary); font-weight: bold; margin-bottom: 4px; display: block; }
        .live-label { background: var(--secondary); font-size: 10px; font-weight: 800; padding: 2px 8px; border-radius: 4px; animation: blink 1.2s infinite; display: inline-block; }
        .btn-play { background: var(--gold-grad); color: #000; border: none; font-weight: 800; padding: 8px 0; border-radius: 8px; width: 140px; margin-top: 8px; transition: 0.3s; }
        .btn-tele { color: #0088cc; font-size: 12px; text-decoration: none; display: block; margin-top: 8px; font-weight: 600; }
        
        /* แก้ไขส่วน Highlight ตามที่สั่ง (ดึงแค่รูป+หัวข้อ) */
        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .news-card { background: var(--bg-card); border-radius: 12px; overflow: hidden; border: 1px solid #222; text-decoration: none; color: #fff; transition: 0.3s; height: 100%; display: block; }
        .news-card:hover { border-color: var(--primary); }
        .news-img { width: 100%; height: 180px; object-fit: cover; }
        .news-body { padding: 15px; background: #1a1d21; }
        .news-title { font-size: 14px; font-weight: 400; line-height: 1.4; color: #fff; }
        
        @keyframes blink { 50% { opacity: 0.3; } }
    </style>
</head>
<body>

<nav class="navbar"><div class="container d-flex justify-content-between align-items-center"><a href="#" class="logo">DOOBALL<span>LAOS</span></a></div></nav>

<div class="container-main">
    <div class="banner-wrapper">
        <div class="banner-item"><img src="https://boengnang.com/wp-content/uploads/2025/12/UFA.gif"></div>
        <div class="banner-item"><img src="https://boengnang.com/wp-content/uploads/2025/12/PRO.gif"></div>
    </div>
    <div class="row">
        <div class="col-lg-8">
            <h4 class="mb-3 text-warning"><i class="bi bi-broadcast"></i> รายการถ่ายทอดสด</h4>
            <div id="match-display"></div>
            
            <h4 class="mt-5 mb-3 text-warning"><i class="bi bi-play-btn-fill"></i> ไฮไลท์ฟุตบอลล่าสุด</h4>
            <div class="news-grid" id="highlights-container"></div>
        </div>
        <div class="col-lg-4">
            <h4 class="mb-3 text-warning"><i class="bi bi-trophy"></i> ตารางคะแนน</h4>
            <iframe src="https://www.scorebar.com/en/football/england/premier-league/standing" style="width:100%; height:1200px; border:none; border-radius:15px;"></iframe>
        </div>
    </div>
</div>

<div id="video-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:10000; align-items:center; justify-content:center; flex-direction:column;">
    <button onclick="closePlayer()" style="background:var(--primary); border:none; padding:8px 25px; border-radius:5px; font-weight:bold; margin-bottom:15px;">✕ ปิดหน้าต่าง</button>
    <div id="player-area" style="width:100%; max-width:1000px; aspect-ratio:16/9; background:#000;"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    const firebaseConfig = {
        databaseURL: "https://football-888-b9a7e-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function initCountdown(id, timeStr) {
        if(!timeStr.includes(':')) return;
        const [h, m] = timeStr.split(':');
        const target = new Date();
        target.setHours(h, m, 0);

        function update() {
            const el = document.getElementById(`timer-${id}`);
            if(!el) return;
            const now = new Date();
            const diff = target - now;
            if(diff > 0) {
                const hh = Math.floor(diff / 3600000).toString().padStart(2, '0');
                const mm = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
                const ss = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
                el.innerText = `เริ่มใน ${hh}:${mm}:${ss}`;
                setTimeout(update, 1000);
            } else { el.innerText = "กำลังแข่งขัน"; }
        }
        update();
    }

    // --- ส่วนที่แก้ไข: เปลี่ยนจากดึงข่าว (news) มาเป็นไฮไลท์ (highlights) ---
    onValue(ref(db, 'highlights'), (snapshot) => {
        const container = document.getElementById('highlights-container');
        const data = snapshot.val();
        if (data) {
            container.innerHTML = Object.values(data).map(h => `
                <a href="${h.link}" target="_blank" class="news-card">
                    <img src="${h.img}" class="news-img" onerror="this.src='https://via.placeholder.com/400x225'">
                    <div class="news-body">
                        <div class="news-title">${h.title}</div>
                    </div>
                </a>
            `).join('');
        }
    });

    onValue(ref(db, 'matches'), (snapshot) => {
        const display = document.getElementById('match-display');
        const data = snapshot.val();
        display.innerHTML = "";
        if (data) {
            const groups = {};
            Object.keys(data).forEach(k => {
                const m = data[k];
                if (!groups[m.league]) groups[m.league] = [];
                groups[m.league].push({...m, id: k});
            });

            Object.keys(groups).forEach(lName => {
                let html = `<div class="league-card"><div class="league-title">${lName}</div>`;
                groups[lName].forEach(m => {
                    const isLive = m.is_live;
                    html += `
                    <div class="match-box">
                        <div class="team team-home"><span>${m.home}</span><img src="${m.home_logo}" class="team-logo"></div>
                        <div class="vs-zone">
                            ${isLive ? '<div class="live-label">● LIVE</div>' : `<span id=\"timer-${m.id}\" class=\"countdown-timer\">--:--:--</span>`}
                            <div class="time-label">${m.time}</div>
                            <div class="d-flex flex-column align-items-center">
                                ${isLive ? `<button class="btn-play" onclick="openPlayer('${m.embed_url}')">รับชมสด</button>` : `<button class="btn btn-secondary btn-sm mt-2" disabled style=\"width:140px; opacity:0.6;\">รอแข่งขัน</button>`}
                                <a href="${m.links?.telegram || 'https://t.me/DoBallLaos'}" target="_blank" class="btn-tele"><i class="bi bi-telegram"></i> กลุ่มสำรอง</a>
                            </div>
                        </div>
                        <div class="team team-away"><img src="${m.away_logo}" class="team-logo"><span>${m.away}</span></div>
                    </div>`;
                    if(!isLive) setTimeout(() => initCountdown(m.id, m.time), 100);
                });
                display.innerHTML += html + `</div>`;
            });
        }
    });

    window.openPlayer = (url) => { 
        document.getElementById('video-overlay').style.display = 'flex';
        const area = document.getElementById('player-area');
        if(url.includes('.m3u8')) {
            area.innerHTML = `<video id="video" controls autoplay style="width:100%; height:100%;"></video>`;
            const video = document.getElementById('video');
            if(Hls.isSupported()) {
                const hls = new Hls(); hls.loadSource(url); hls.attachMedia(video);
            }
        } else {
            area.innerHTML = `<iframe src="${url}" style="width:100%; height:100%; border:none;" allowfullscreen></iframe>`;
        }
    };
    window.closePlayer = () => { 
        document.getElementById('video-overlay').style.display = 'none'; 
        document.getElementById('player-area').innerHTML = "";
    };
</script>
</body>
</html>
